{% extends "base.html" %}

{% block content %}
<div class="page-header">
    <div>
        <h1 class="page-title">HR Dashboard</h1>
        <p class="page-subtitle">Manage placement drives and candidates</p>
    </div>
    <div class="role-badge hr">
        <i class="fas fa-building"></i> {{ current_user.role }}
    </div>
</div>

<!-- Profile Card -->
<div class="card slide-up">
    <div class="flex items-center justify-between" style="flex-wrap: wrap; gap: 1rem;">
        <div class="flex items-center gap-2">
            <div class="stat-icon purple" style="width: 56px; height: 56px; font-size: 24px;">
                <i class="fas fa-user-tie"></i>
            </div>
            <div>
                <h3 style="margin:0; font-size: 20px;">{{ current_user.username }}</h3>
                <p style="margin:0; font-size: 14px; color: var(--text-secondary);">{{ current_user.email }}</p>
            </div>
        </div>
        <div class="flex gap-1" style="flex-wrap: wrap;">
            {% if current_user.totp_enabled %}
            <span class="security-badge verified">
                <i class="fas fa-shield-alt"></i> MFA Active
            </span>
            {% else %}
            <span class="badge badge-warning">
                <i class="fas fa-exclamation-triangle"></i> MFA Pending
            </span>
            {% endif %}
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
    <a href="{{ url_for('hr.post_job') }}" class="stat-card" style="text-decoration: none; cursor: pointer;">
        <div class="stat-icon green">
            <i class="fas fa-plus-circle"></i>
        </div>
        <div class="stat-content">
            <h4 style="margin:0; font-size: 16px;">Post New Job</h4>
            <p style="font-size: 12px;">Create placement drive</p>
        </div>
    </a>

    <div class="stat-card">
        <div class="stat-icon blue">
            <i class="fas fa-briefcase"></i>
        </div>
        <div class="stat-content">
            <h3>{{ jobs|length }}</h3>
            <p>Jobs Posted</p>
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-icon purple">
            <i class="fas fa-users"></i>
        </div>
        <div class="stat-content">
            <h3>{{ total_applicants }}</h3>
            <p>Total Applicants</p>
        </div>
    </div>
</div>

<!-- Posted Jobs -->
<div class="card">
    <div class="card-header">
        <h2 class="card-title"><i class="fas fa-list-alt"></i> My Posted Jobs</h2>
        <a href="{{ url_for('hr.post_job') }}" class="btn btn-sm btn-primary">
            <i class="fas fa-plus"></i> New Job
        </a>
    </div>

    {% if jobs %}
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Job Title</th>
                    <th>Company</th>
                    <th>Posted Date</th>
                    <th>Applicants</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for item in job_stats %}
                <tr>
                    <td><strong>{{ item.job.title }}</strong></td>
                    <td><i class="fas fa-building"></i> {{ item.job.company }}</td>
                    <td><i class="fas fa-calendar"></i> {{ item.job.posted_date.strftime('%d %b %Y') }}</td>
                    <td>
                        <span class="badge badge-info">{{ item.count }} applicants</span>
                    </td>
                    <td>
                        <a href="{{ url_for('hr.review_applicants', job_id=item.job.id) }}"
                            class="btn btn-sm btn-outline">
                            <i class="fas fa-users"></i> Review
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="empty-state">
        <i class="fas fa-briefcase"></i>
        <h3>No Jobs Posted Yet</h3>
        <p>Create your first placement drive to start receiving applications.</p>
        <a href="{{ url_for('hr.post_job') }}" class="btn btn-primary mt-2">
            <i class="fas fa-plus"></i> Post a Job
        </a>
    </div>
    {% endif %}
</div>

<!-- Security Features -->
<div class="card" style="border-left: 4px solid var(--accent-purple);">
    <h3><i class="fas fa-key"></i> Your Security Privileges</h3>
    <div class="quick-links" style="margin-top: 1rem;">
        <div class="quick-link" style="cursor: default;">
            <div class="quick-link-icon" style="background: rgba(16, 185, 129, 0.15); color: #10b981;">
                <i class="fas fa-file-alt"></i>
            </div>
            <div class="quick-link-content">
                <h4>Decrypt Resumes</h4>
                <p>View encrypted student resumes</p>
            </div>
        </div>

        <div class="quick-link" style="cursor: default;">
            <div class="quick-link-icon" style="background: rgba(59, 130, 246, 0.15); color: #3b82f6;">
                <i class="fas fa-signature"></i>
            </div>
            <div class="quick-link-content">
                <h4>Sign Results</h4>
                <p>Digitally sign placement results</p>
            </div>
        </div>

        <div class="quick-link" style="cursor: default;">
            <div class="quick-link-icon" style="background: rgba(139, 92, 246, 0.15); color: #8b5cf6;">
                <i class="fas fa-user-check"></i>
            </div>
            <div class="quick-link-content">
                <h4>Manage Applicants</h4>
                <p>Shortlist and reject candidates</p>
            </div>
        </div>
    </div>
</div>

<!-- Security Status -->
<div class="card" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed); color: white;">
    <div class="flex items-center gap-2">
        <i class="fas fa-lock" style="font-size: 24px;"></i>
        <div>
            <h4 style="margin:0;">Authorized Access Level: HR</h4>
            <p style="margin:4px 0 0; opacity: 0.9; font-size: 13px;">
                You can decrypt student resumes • Publish digitally signed results • Manage applicant status
            </p>
        </div>
    </div>
</div>
{% endblock %}