{% extends "base.html" %}

{% block content %}
<h2>Applicants for: {{ job.title }}</h2>
<a href="{{ url_for('hr.dashboard') }}">&larr; Back to Dashboard</a>
<br><br>

{% if not applicants %}
<p>No applicants yet.</p>
{% else %}
<div style="display: flex; flex-direction: column; gap: 20px;">
    {% for app in applicants %}
    <div class="card">
        <h3>Student: {{ app.student_name }}</h3>
        <p><strong>Status:</strong> {{ app.status }}</p>

        <div
            style="background: #f1f2f6; padding: 15px; border-radius: 8px; border-left: 5px solid #00b894; margin-bottom: 15px;">
            <h4><i class="fas fa-file-alt"></i> Resume (Encrypted Storage)</h4>
            {% if app.resume %}
            <p><strong>Filename:</strong> {{ app.resume.filename }}</p>

            <!-- Decrypted Preview Box -->
            <div
                style="background: #2d3436; color: #55efc4; padding: 15px; border-radius: 8px; margin: 10px 0; font-family: monospace;">
                <h5 style="color: #ffeaa7; margin-top: 0;"><i class="fas fa-unlock"></i> DECRYPTED CONTENT:</h5>
                <pre
                    style="white-space: pre-wrap; word-break: break-all; color: #dfe6e9; margin: 0;">{{ app.decrypted_preview }}</pre>
            </div>

            <a href="{{ url_for('hr.download_resume', resume_id=app.resume.id) }}" class="btn"
                style="background: #00b894;">
                <i class="fas fa-download"></i> Download Decrypted File
            </a>
            {% else %}
            <p style="color: #d63031;"><i class="fas fa-exclamation-triangle"></i> No resume uploaded by this student.
            </p>
            {% endif %}
        </div>

        {% if app.status != 'Placed' %}
        <a href="{{ url_for('hr.publish_result', student_id=app.student_id) }}" class="btn">Select & Publish Result</a>
        {% else %}
        <button class="btn btn-secondary" disabled>Already Placed</button>
        {% endif %}
    </div>
    {% endfor %}
</div>
{% endif %}
{% endblock %}